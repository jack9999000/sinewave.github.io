<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>駐波實驗 - 右牆固定振幅0</title>
  <style>
    body { background-color:#111; color:#eee; text-align:center; margin:0; overflow:hidden; font-family:sans-serif; }
    h2 { margin-top:10px; font-weight:600; color:#00ffff; text-shadow:0 0 10px #0ff; }
    canvas { display:block; margin:0 auto; background-color:#222; box-shadow:0 0 15px #000; border-radius:8px; }
    .controls { position:absolute; top:20px; left:20px; background-color:rgba(0,0,0,0.7); padding:15px; border-radius:12px; box-shadow:0 0 12px #000; text-align:left; width:250px; }
    .controls label { display:flex; justify-content:space-between; margin-top:12px; font-size:14px; }
    .slider { -webkit-appearance:none; appearance:none; width:180px; height:6px; border-radius:4px; background:linear-gradient(90deg,#00ffff,#0077ff); outline:none; cursor:pointer; margin-top:4px; transition:background 0.3s; }
    .slider::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:#fff; border:2px solid #00ffff; box-shadow:0 0 10px #00ffff; cursor:grab; transition:transform 0.2s; }
    .slider::-webkit-slider-thumb:active { transform:scale(1.2); cursor:grabbing; }
    .value { font-weight:bold; color:#0ff; margin-left:5px; }
  </style>
</head>
<body>
  <h2>駐波實驗 - 右牆固定振幅0</h2>
  <div class="controls">
    <label>振幅 A: <span id="ampVal" class="value">30</span></label>
    <input type="range" id="ampSlider" class="slider" min="5" max="50" value="30">

    <label>播放速度: <span id="speedVal" class="value">15</span></label>
    <input type="range" id="speedSlider" class="slider" min="1" max="30" step="1" value="15">

    <label>駐波個數 n: <span id="modeVal" class="value">1</span></label>
    <input type="range" id="modeSlider" class="slider" min="1" max="10" step="1" value="1">
  </div>

  <canvas id="waveCanvas" width="900" height="400"></canvas>

  <script>
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;

    let time = 0;
    let A = 30, speed = 15, v = 50*speed, mode = 1;
    const dx = 2, wallWidth = 10;

    const ampSlider = document.getElementById('ampSlider');
    const speedSlider = document.getElementById('speedSlider');
    const modeSlider = document.getElementById('modeSlider');

    const ampVal = document.getElementById('ampVal');
    const speedVal = document.getElementById('speedVal');
    const modeVal = document.getElementById('modeVal');

    const L = width - 2*wallWidth;
    const trail = [];
    const maxTrailLength = 150;

    ampSlider.addEventListener('input', updateParams);
    speedSlider.addEventListener('input', updateParams);
    modeSlider.addEventListener('input', updateParams);

    function rebuildTrail() {
      trail.length = 0;
      const len = Math.floor(L/dx);
      for(let i=0;i<len;i++) trail.push([]);
    }

    function updateParams() {
      A = parseFloat(ampSlider.value);
      speed = parseFloat(speedSlider.value);
      v = 50*speed;
      mode = parseInt(modeSlider.value);

      ampVal.textContent = A;
      speedVal.textContent = speed;
      modeVal.textContent = mode;

      rebuildTrail();
    }

    updateParams();

    function draw() {
      ctx.clearRect(0,0,width,height);

      // 畫牆
      ctx.fillStyle='#555';
      ctx.fillRect(0,0,wallWidth,height);
      ctx.fillRect(width-wallWidth,0,wallWidth,height);

      const k = Math.PI * mode / L;
      const w = v * k;

      const yValues = [];
      for(let x=0;x<L;x+=dx){
        const y = 2*A * Math.sin(k*x) * Math.cos(w*time);
        yValues.push(y);
      }

      // 更新軌跡
      for(let i=0;i<yValues.length;i++){
        trail[i].push(yValues[i]);
        if(trail[i].length>maxTrailLength) trail[i].shift();
      }

      // 畫軌跡（漸淡）
      for(let i=0;i<trail.length;i++){
        ctx.beginPath();
        for(let t=0;t<trail[i].length;t++){
          const x = wallWidth + i*dx;
          const y = height/2 - trail[i][t];
          if(t===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        // 透明度漸淡
        ctx.strokeStyle = `rgba(255,0,255,${0.2 * (t/trail[i].length)})`;
        ctx.lineWidth = 1;
        ctx.stroke();
      }

      // 畫主波
      ctx.beginPath();
      for(let i=0;i<yValues.length;i++){
        const x = wallWidth + i*dx;
        ctx.lineTo(x,height/2 - yValues[i]);
      }
      ctx.strokeStyle='#00ffff';
      ctx.lineWidth=2;
      ctx.stroke();

      // 畫理論駐波節點
      if(mode > 0){
        const step = L/mode;
        ctx.strokeStyle='rgba(255,255,0,0.5)';
        ctx.lineWidth=1;
        for(let i=0;i<=mode;i++){
          const x = wallWidth + i*step;
          ctx.beginPath();
          ctx.moveTo(x,0);
          ctx.lineTo(x,height);
          ctx.stroke();
        }
      }

      time += 0.1; // 加快播放速度
      requestAnimationFrame(draw);
    }

    draw();
  </script>
</body>
</html>
