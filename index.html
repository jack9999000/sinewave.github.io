<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>駐波模擬（完整波長顯示）</title>
  <style>
    body { background-color:#111; color:#eee; text-align:center; margin:0; overflow:hidden; font-family:sans-serif; }
    h2 { margin-top:10px; font-weight:600; color:#00ffff; text-shadow:0 0 10px #0ff; }
    canvas { display:block; margin:0 auto; background-color:#222; box-shadow:0 0 15px #000; border-radius:8px; }
    .controls { position:absolute; top:20px; left:20px; background-color:rgba(0,0,0,0.7); padding:15px; border-radius:12px; box-shadow:0 0 12px #000; text-align:left; width:220px; }
    .controls label { display:flex; justify-content:space-between; margin-top:12px; font-size:14px; }
    .slider { -webkit-appearance:none; appearance:none; width:180px; height:6px; border-radius:4px; background:linear-gradient(90deg,#00ffff,#0077ff); outline:none; cursor:pointer; margin-top:4px; transition:background 0.3s; }
    .slider::-webkit-slider-thumb { -webkit-appearance:none; appearance:none; width:16px; height:16px; border-radius:50%; background:#fff; border:2px solid #00ffff; box-shadow:0 0 10px #00ffff; cursor:grab; transition:transform 0.2s; }
    .slider::-webkit-slider-thumb:active { transform:scale(1.2); cursor:grabbing; }
    .value { font-weight:bold; color:#0ff; margin-left:5px; }
  </style>
</head>
<body>
  <h2>駐波模擬（完整波長顯示）</h2>
  <div class="controls">
    <label>振幅 A: <span id="ampVal" class="value">30</span></label>
    <input type="range" id="ampSlider" class="slider" min="5" max="50" value="30">

    <label>波長 λ: <span id="lambdaVal" class="value">50</span></label>
    <input type="range" id="lambdaSlider" class="slider" min="10" max="100" step="1" value="50">

    <label>播放速度: <span id="speedVal" class="value">5</span></label>
    <input type="range" id="speedSlider" class="slider" min="1" max="10" step="1" value="5">

    <label>駐波個數 n: <span id="modeVal" class="value">1</span></label>
  </div>

  <canvas id="waveCanvas" width="900" height="400"></canvas>

  <script>
    const canvas = document.getElementById('waveCanvas');
    const ctx = canvas.getContext('2d');
    const width = canvas.width;
    const height = canvas.height;

    let time = 0;
    let A = 30, lambda_val = 50, lambda = lambda_val*10, speed = 5, v = 50*speed, mode = 1;
    const dx = 2, wallWidth = 10;

    const ampSlider = document.getElementById('ampSlider');
    const lambdaSlider = document.getElementById('lambdaSlider');
    const speedSlider = document.getElementById('speedSlider');
    const modeVal = document.getElementById('modeVal');

    const ampVal = document.getElementById('ampVal');
    const lambdaValEl = document.getElementById('lambdaVal');
    const speedVal = document.getElementById('speedVal');

    const L = width - 2*wallWidth;
    const trail = [];
    const maxTrailLength = 150;

    function rebuildTrail() {
      trail.length = 0;
      const len = Math.floor(L/dx);
      for(let i=0;i<len;i++) trail.push([]);
    }

    function updateParams() {
      A = parseFloat(ampSlider.value);
      lambda_val = parseFloat(lambdaSlider.value);
      lambda = lambda_val*10;  // 波長 = 10 * sliderValue
      speed = parseFloat(speedSlider.value);
      v = 50*speed;

      // 判斷是否符合完整駐波
      const nExact = 2*L / lambda;
      if(Math.abs(nExact - Math.round(nExact)) < 1e-6) {
        mode = Math.round(nExact);
      } else {
        mode = 0;
      }

      ampVal.textContent = A;
      lambdaValEl.textContent = lambda_val.toFixed(0);
      speedVal.textContent = speed;
      modeVal.textContent = mode;

      rebuildTrail();
    }

    ampSlider.addEventListener('input',updateParams);
    lambdaSlider.addEventListener('input',updateParams);
    speedSlider.addEventListener('input',updateParams);

    updateParams();

    function draw() {
      ctx.clearRect(0,0,width,height);

      // 畫牆
      ctx.fillStyle='#555';
      ctx.fillRect(0,0,wallWidth,height);
      ctx.fillRect(width-wallWidth,0,wallWidth,height);

      const k = 2 * Math.PI / lambda;
      const w = v * k;

      const yValues = [];
      for(let x=0;x<L;x+=dx){
        // 兩個反向行進波疊加
        const y = A * Math.sin(k*x - w*time) + A * Math.sin(k*x + w*time);
        yValues.push(y);
      }

      // 更新軌跡
      for(let i=0;i<yValues.length;i++){
        trail[i].push(yValues[i]);
        if(trail[i].length>maxTrailLength) trail[i].shift();
      }

      // 畫軌跡
      for(let i=0;i<trail.length;i++){
        ctx.beginPath();
        for(let t=0;t<trail[i].length;t++){
          const x = wallWidth + i*dx;
          const y = height/2 - trail[i][t];
          if(t===0) ctx.moveTo(x,y);
          else ctx.lineTo(x,y);
        }
        ctx.strokeStyle='rgba(255,0,255,0.2)';
        ctx.lineWidth=1;
        ctx.stroke();
      }

      // 畫主波
      ctx.beginPath();
      for(let i=0;i<yValues.length;i++){
        const x = wallWidth + i*dx;
        ctx.lineTo(x,height/2 - yValues[i]);
      }
      ctx.strokeStyle='#00ffff';
      ctx.lineWidth=2;
      ctx.stroke();

      time += 0.02;
      requestAnimationFrame(draw);
    }

    draw();
  </script>
</body>
</html>
